%% init the music variables

mrMusic.init;

%% melody definition

barDurationSeconds=1.8; 
timeSignature = 4/4;

% The Entertainer by Scott Joplin 
% 3-voice MRI version by Jochen Leupold
melody = {
    % bar 1
    [d3/8 e3/8 c3/8 a2/8 o/8 h2/8 g2/8 o/8 ],...
    [o],...
    [o];...
    
    [d2/8 e2/8 c2/8 a1/8 o/8 h1/8 g1/8 o/8 ],...
    [o],...
    [o];...
    
    [d1/8 e1/8 c1/8 ab/8 o/8 hb/8 ab/8 gisb/8 ],...
    [o],...
    [o];...
    
    [gb/8 o/8 o/8 o/8 g1/8 o/8 d1/8 dis1/8 ],...
    [o/2 h1/8 o/8 o/8 o/8 ],...
    [o/2 d2/8 o/8 o/8 o/8 ];...
    % marker 0
    [e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...
    [o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 a1/8 ],...
    [cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [a1/8 a1/8 a1/8 a1/8 o/8 e1/8 f1/8 fis1/8 ],...
    [fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ];...
    
    [e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ]...
    [g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...
    [dbb/8 o/8 abb/8 o/8 gbb/8 o/8 hbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 c2/8 o/8 d1/8 dis1/8 ],...
    [e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 o/8 ],...
    [cb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 ];...
    % marker 1
    [e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...
    [o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 c1/8 ],...
    [cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 c2/8 o/8 a1/8 g1/8 ],...
    [a1/8 a1/8 a1/8 a1/8 a1/8 o/8 c1/8 hb/8 ],...
    [fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ];...
    
    [fis1/8 a1/8 c2/8 e2/8 e2/8 d2/8 c2/8 a1/8 ],...
    [ab/8 c1/8 e1/8 g1/8 g1/8 f1/8 e1/8 c1/8 ],...
    [dbb/8 o/8 fisbb/8 o/8 abb/8 o/8 hbb/8 o/8 ];...
    
    [d2/8 d2/8 d2/8 d2/8 d2/8 o/8 d1/8 dis1/8 ],...
    [f1/8 f1/8 f1/8 f1/8 f1/8 o/8 o/8 o/8 ],...
    [db/8 o/8 hbb/8 o/8 gbb/8 o/8 o/8 o/8 ];...
    % marker 2
    [e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...
    [o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 a1/8 ],...
    [cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [a1/8 a1/8 a1/8 a1/8 o/8 e1/8 f1/8 fis1/8 ],...
    [fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ];...
    
    [e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ],...
    [g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...
    [dbb/8 o/8 abb/8 o/8 gbb/8 o/8 hbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 ],...
    [e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 o/8 ],...
    [cb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 ];...
    % marker 3
    [e2/8 c2/8 d2/8 e2/8 e2/8 c2/8 d2/8 c2/8 ],...
    [g1/8 e1/8 f1/8 g1/8 g1/8 e1/8 f1/8 e1/8 ],...
    [cb/8 o/8 cb/8 o/8 aisbb/8 o/8 aisbb/8 o/8 ];...
    
    [e2/8 c2/8 d2/8 e2/8 e2/8 c2/8 d2/8 c2/8 ],...
    [g1/8 e1/8 f1/8 g1/8 g1/8 e1/8 f1/8 e1/8 ],...
    [abb/8 o/8 abb/8 o/8 gisbb/8 o/8 gisbb/8 o/8 ];...
    
    [e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ],...
    [g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...
    [gbb/8 o/8 fbb/8 o/8 ebb/8 o/8 dbb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [e1/8 e1/8 e1/8 e1/8 o/8 e2/8 f2/8 fis2/8 ],...
    [cbb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 ];...
    
    [e2/8 o/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [g2/8 o/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ];...
    
    [e2/8 o/8 f2/8 e2/8 o/8 e2/8 c2/8 g1/8 ],...
    [g2/8 o/8 a2/8 g2/8 o/8 e2/8 c2/8 g1/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ];...
    
    [a1/8 h1/8 c2/8 d2/8 e2/8 d2/8 c2/8 d2/8 ],...
    [ab/8 hb/8 c1/8 d1/8 e1/8 d1/8 c1/8 d1/8 ],...
    [fbb/8 o/8 cb/8 o/8 cbb/8 o/8 cb/8 o/8 ];...
    % marker 4
    [c2/8 c2/8 c2/8 c2/8 o/8 e2/8 f2/8 fis2/8 ],...
    [c1/8 c1/8 c1/8 c1/8 o/8 c2/8 d2/8 dis2/8 ],...
    [cb/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8 ];...
    
    [e2/8 e2/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [g2/8 g2/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 cb/8 o/8 ];...
    
    [e2/8 e2/8 f2/8 e2/8 o/8 g2/8 a2/8 ais2/8 ],...
    [g2/8 g2/8 a2/8 g2/8 o/8 e2/8 dis2/8 dis2/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 cb/8 o/8 ];...
    
    [h2/16 h2/32 o /32 h2/16 h2/32 h2 /32 h2 /16 o/16 h2/8 h2/8 a2/8 fis2/8 d2/8 ],...
    [d2/16 d2/32 o/32 d2/16 d2/32 d2/32 d2/16 o/16 d2/8 d2/8 c2/8 a1/8 a1/8 ],...
    [db/8 o/8 ab/8 o/8 abb/8 o/8 ab/8 o/8 ];...
    % marker 5
    [g2/8 g2/8 g2/8 g2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [h1/8 h1/8 h1/8 h1/8 o/8 e2/8 f2/8 fis2/8 ],...
    [gbb/8 o/8 db/8 o/8 gbb/8 o/8 gb/8 o/8 ];...
    % marker 6
    [e2/8 o/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...
    [g2/8 o/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ];...
    
    [e2/8 o/8 f2/8 e2/8 o/8 e2/8 c2/8 g1/8 ],...
    [g2/8 o/8 a2/8 g2/8 o/8 e2/8 c2/8 g1/8 ],...
    [cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ];...
    
    [a1/8 h1/8 c2/8 d2/8 e2/8 d2/8 c2/8 d2/8 ],...
    [ab/8 hb/8 c1/8 d1/8 e1/8 d1/8 c1/8 d1/8 ],...
    [fbb/8 o/8 cb/8 o/8 cbb/8 o/8 cb/8 o/8 ];...
    % marker 7
    [c2/8 c2/8 c2/8 c2/8 o/8 g1/8 fis1/8 g1/8 ],...
    [c1/8 c1/8 c1/8 c1/8 o/8 e1/8 dis1/8 e1/8 ],...
    [cb/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8 ];...
    
    [c2/8 c2/8 a1/8 c2/8 c2/8 a1/8 c2/8 a1/8 ],...
    [db/8 db/16 db/32 o/32 db/8 db/16 db/32 o/32 disb/8 disb/16 disb/32 o/32 disb/8 disb/16 disb/32 o/32 ],...
    [fb/8 fb/16 fb/32 o/32 fb/8 fb/16 fb/32 o/32 fisb/8 fisb/16 fisb/32 o/32 fisb/8 fisb/16 fisb/32 o/32 ];...
    
    [g1/8 c2/8 e2/8 g2/8 g2/8 e2/8 c2/8 g1/8 ],...
    [e1/8 g1/8 c2/8 cis2/8 cis2/8 c2/8 g1/8 cis1/8 ],...
    [gb/8 gb/8 gb/8 ab/8 ab/8 gb/8 eb/8 eb/8 ];...
    
    [a1/8 a1/8 c2/8 c2/8 e2/8 d2/8 d2/8 c2/8 ],...
    [c1/8 c1/8 fis1/8 fis1/8 g1/8 f1/8 f1/8 e1/8 ],...
    [db/8 o/8 ab/8 o/8 gb/8 o/8 hb/8 o/8 ];...
    
    [c2/8 c2/8 c2/8 c2/8 c2/8 c2/8 o/8 o/8 ],...
    [e1/8 e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 ],...
    [c1/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8];
};    

%     % bar X
%     [], ...
%     [], ...
%     []; ...

% cat entertainer.cpp | grep 'freq.*n1\|^\s*$' | sed 's/freq.=\(.*\); n1=\([0-9]*\); for.*/\1\/\2/;s/^0/o/;s/^\s*$/x/' | tr '\n\r' '  ' | sed 's/x /x/g;s/xx*/x/g;s/x/],...[/g'
% d3/8 e3/8 c3/8 a2/8 o/8 h2/8 g2/8 o/8 ],...[d2/8 e2/8 c2/8 a1/8 o/8 h1/8 g1/8 o/8 ],...[d1/8 e1/8 c1/8 ab/8 o/8 hb/8 ab/8 gisb/8 ],...[gb/8 o/8 o/8 o/8 ],...[				g1/8 ],...[								h1/8 							d2/8 ],...[o/8 ],...[						0/8 							0/8 d1/8 dis1/8 o/8 o/8 o/8 o/8 ],...[e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...[c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...[e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ],...[o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 a1/8 ],...[a1/8 a1/8 a1/8 a1/8 o/8 e1/8 f1/8 fis1/8 ],...[g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...[cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ],...[fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ],...[dbb/8 o/8 abb/8 o/8 gbb/8 o/8 hbb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 c2/8 o/8 d1/8 dis1/8 ],...[e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 o/8 ],...[cb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...[c2/8 c2/8 c2/8 c2/8 c2/8 o/8 a1/8 g1/8 ],...[fis1/8 a1/8 c2/8 e2/8 e2/8 d2/8 c2/8 a1/8 ],...[o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 c1/8 ],...[a1/8 a1/8 a1/8 a1/8 a1/8 o/8 c1/8 hb/8 ],...[ab/8 c1/8 e1/8 g1/8 g1/8 f1/8 e1/8 c1/8 ],...[cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ],...[fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ],...[dbb/8 o/8 fisbb/8 o/8 abb/8 o/8 hbb/8 o/8 ],...[d2/8 d2/8 d2/8 d2/8 d2/8 o/8 d1/8 dis1/8 ],...[f1/8 f1/8 f1/8 f1/8 f1/8 o/8 o/8 o/8 ],...[db/8 o/8 hbb/8 o/8 gbb/8 o/8 o/8 o/8 ],...[e1/8 c2/8 c2/8 e1/8 c2/8 o/8 e1/8 c2/8 ],...[c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...[e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ],...[o/8 o/8 eb/8 o/8 o/8 o/8 eb/8 a1/8 ],...[a1/8 a1/8 a1/8 a1/8 o/8 e1/8 f1/8 fis1/8 ],...[g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...[cbb/8 o/8 cb/8 o/8 ebb/8 o/8 aisbb/8 o/8 ],...[fbb/8 o/8 cb/8 o/8 ebb/8 o/8 cb/8 o/8 ],...[dbb/8 o/8 abb/8 o/8 gbb/8 o/8 hbb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 ],...[e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 o/8 ],...[cb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 ],...[e2/8 c2/8 d2/8 e2/8 e2/8 c2/8 d2/8 c2/8 ],...[e2/8 c2/8 d2/8 e2/8 e2/8 c2/8 d2/8 c2/8 ],...[e2/8 c2/8 d2/8 e2/8 e2/8 h1/8 d2/8 d2/8 ],...[g1/8 e1/8 f1/8 g1/8 g1/8 e1/8 f1/8 e1/8 ],...[g1/8 e1/8 f1/8 g1/8 g1/8 e1/8 f1/8 e1/8 ],...[g1/8 e1/8 f1/8 g1/8 g1/8 d1/8 f1/8 f1/8 ],...[cb/8 o/8 cb/8 o/8 aisbb/8 o/8 aisbb/8 o/8 ],...[abb/8 o/8 abb/8 o/8 gisbb/8 o/8 gisbb/8 o/8 ],...[gbb/8 o/8 fbb/8 o/8 ebb/8 o/8 dbb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 o/8 c2/8 d2/8 dis2/8 ],...[e1/8 e1/8 e1/8 e1/8 o/8 e2/8 f2/8 fis2/8 ],...[cbb/8 o/8 gbb/8 o/8 cbb/8 o/8 o/8 o/8 ],...[e2/8 o/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...[e2/8 o/8 f2/8 e2/8 o/8 e2/8 c2/8 g1/8 ],...[a1/8 h1/8 c2/8 d2/8 e2/8 d2/8 c2/8 d2/8 ],...[g2/8 o/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...[g2/8 o/8 a2/8 g2/8 o/8 e2/8 c2/8 g1/8 ],...[ab/8 hb/8 c1/8 d1/8 e1/8 d1/8 c1/8 d1/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ],...[fbb/8 o/8 cb/8 o/8 cbb/8 o/8 cb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 o/8 e2/8 f2/8 fis2/8 ],...[e2/8 e2/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...[e2/8 e2/8 f2/8 e2/8 o/8 g2/8 a2/8 ais2/8 ],...[h2/16 h2/32 o /32 h2/16 h2/32 h2 /32 h2 /16 o/16 h2/8 h2/8 a2/8 fis2/8 d2/8 ],...[c1/8 c1/8 c1/8 c1/8 o/8 c2/8 d2/8 dis2/8 ],...[g2/8 g2/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...[g2/8 g2/8 a2/8 g2/8 o/8 e2/8 dis2/8 dis2/8 ],...[d2/16 d2/32 o/32 d2/16 d2/32 d2/32 d2/16 o/16 d2/8 d2/8 c2/8 a1/8 a1/8 ],...[cb/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 cb/8 o/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 cb/8 o/8 ],...[db/8 o/8 ab/8 o/8 abb/8 o/8 ab/8 o/8 ],...[g2/8 g2/8 g2/8 g2/8 o/8 c2/8 d2/8 dis2/8 ],...[h1/8 h1/8 h1/8 h1/8 o/8 e2/8 f2/8 fis2/8 ],...[gbb/8 o/8 db/8 o/8 gbb/8 o/8 gb/8 o/8 ],...[e2/8 o/8 f2/8 e2/8 o/8 c2/8 d2/8 dis2/8 ],...[e2/8 o/8 f2/8 e2/8 o/8 e2/8 c2/8 g1/8 ],...[a1/8 h1/8 c2/8 d2/8 e2/8 d2/8 c2/8 d2/8 ],...[g2/8 o/8 a2/8 g2/8 o/8 e2/8 f2/8 fis2/8 ],...[g2/8 o/8 a2/8 g2/8 o/8 e2/8 c2/8 g1/8 ],...[ab/8 hb/8 c1/8 d1/8 e1/8 d1/8 c1/8 d1/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ],...[cb/8 o/8 gb/8 o/8 gbb/8 o/8 gb/8 o/8 ],...[fbb/8 o/8 cb/8 o/8 cbb/8 o/8 cb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 o/8 g1/8 fis1/8 g1/8 ],...[c1/8 c1/8 c1/8 c1/8 o/8 e1/8 dis1/8 e1/8 ],...[cb/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8 ],...[c2/8 c2/8 a1/8 c2/8 c2/8 a1/8 c2/8 a1/8 ],...[db/8 db/16 db/32 o/32 db/8 db/16 db/32 o/32 disb/8 disb/16 disb/32 o/32 disb/8 disb/16 disb/32 o/32 ],...[fb/8 fb/16 fb/32 o/32 fb/8 fb/16 fb/32 o/32 fisb/8 fisb/16 fisb/32 o/32 fisb/8 fisb/16 fisb/32 o/32 ],...[g1/8 c2/8 e2/8 g2/8 g2/8 e2/8 c2/8 g1/8 ],...[e1/8 g1/8 c2/8 cis2/8 cis2/8 c2/8 g1/8 cis1/8 ],...[gb/8 gb/8 gb/8 ab/8 ab/8 gb/8 eb/8 eb/8 ],...[a1/8 a1/8 c2/8 c2/8 e2/8 d2/8 d2/8 c2/8 ],...[c1/8 c1/8 fis1/8 fis1/8 g1/8 f1/8 f1/8 e1/8 ],...[db/8 o/8 ab/8 o/8 gb/8 o/8 hb/8 o/8 ],...[c2/8 c2/8 c2/8 c2/8 c2/8 c2/8 o/8 o/8 ],...[e1/8 e1/8 e1/8 e1/8 e1/8 e1/8 o/8 o/8 ],...[c1/8 o/8 gb/8 o/8 cb/8 o/8 o/8 o/8

%% convert to the channel-frequency table

[pitches, durations] = mrMusic.melodyToPitchesAndDurations(melody,'timeSignature',timeSignature);

%% Pulseq sequence 

% never use full gradient performance because it is almost impossible to
% avoid the mechanical resonances of the gradient system completely
sys = mr.opts('MaxGrad',18,'GradUnit','mT/m',...
    'MaxSlew',160,'SlewUnit','T/m/s',...
    'rfRingdownTime', 20e-6, 'rfDeadtime', 100e-6 ...
);  
seq=mr.Sequence(sys);      % Create a new sequence object

pulseqUseWave=false; % use the "UseWave" option with case as it is really demanding both on the Pulseq environment and the scanner (shape memory)

seq = mrMusic.musicToSequence(seq, pitches, durations, 'barDurationSeconds', barDurationSeconds, 'pulseqUseWave', pulseqUseWave);

%% output
if pulseqUseWave
    seq.setDefinition('Name', 'entertainer');
    seq.write('entertainer.seq');
else
    seq.setDefinition('Name', 'entertainer1');
    seq.write('entertainer1.seq');
end

return
%% play

seq.sound();

return
%% optional slow step for checking whether we are staying within slew rate limits  

rep = seq.testReport; 
fprintf([rep{:}]); 
